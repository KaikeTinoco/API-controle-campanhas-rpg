# API de Controle de Campanhas de RPG üé≤

![ai-gen](https://img.shields.io/badge/ai--gen-ready-blue) ![Java](https://img.shields.io/badge/Java-17-informational) ![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.4.5-brightgreen)

**API REST para gerenciar campanhas e personagens de RPG**, criada para integrar com os bots:
- https://github.com/KaikeTinoco/Bot-Gerador-de-Hist-ria
- https://github.com/KaikeTinoco/Bot-Gerador-de-Personagens

Esta API permite criar/consultar/atualizar campanhas e personagens, persistindo via JPA e expondo documenta√ß√£o autom√°tica via OpenAPI/Swagger.

√çndice
- Vis√£o Geral
- Tecnologias
- Requisitos
- Quick Start (executar localmente)
- Endpoints principais (tabela)
- Exemplos R√°pidos (cURL / JSON)
- Documenta√ß√£o (Swagger / OpenAPI)
- Configura√ß√£o de banco de dados
- Testes
- Estrutura do projeto
- Tratamento de Erros
- Contribui√ß√£o
- Contato

---

## üîé Vis√£o Geral
**O que faz:** gerencia campanhas (contexto, notas, personagens) e personagens (NPCs/jogadores).  
**Principais responsabilidades:** CRUD de Campanha e Personagem, valida√ß√µes simples, persist√™ncia JPA e documenta√ß√£o OpenAPI.

---

## üß∞ Tecnologias
- **Java 17**
- **Spring Boot 3.4.5** (Web, Data JPA, Validation)
- **springdoc-openapi** (Swagger UI)
- **Lombok**
- **H2** (dev) e **PostgreSQL** (opcional produ√ß√£o)
- **Maven** (wrapper inclu√≠do)

---

## ‚úÖ Requisitos
- Java 17+
- Maven (opcional ‚Äî use o wrapper `./mvnw`)
- (Opcional) PostgreSQL para produ√ß√£o

---

## üöÄ Quick Start (executar localmente)

1) Rodar com Maven Wrapper

Linux / macOS:
```bash
./mvnw spring-boot:run
```

Windows (cmd/powershell):
```powershell
mvnw.cmd spring-boot:run
```

2) Gerar jar e executar:
```bash
./mvnw clean package
java -jar target/api-0.0.1-SNAPSHOT.jar
```

A aplica√ß√£o inicia por padr√£o em:
http://localhost:8080

Executar testes:
```bash
./mvnw test
```

---

## üß≠ Endpoints principais

Base URL (local): `http://localhost:8080`

| Request | Descri√ß√£o | Par√¢metros | Resultado |
|---|---:|---|---|
| POST /campanha/criar | **Cria uma nova campanha** a partir de CampanhaDTO | Body (JSON): CampanhaDTO { nome, sistema, descricaoHistoria, restricoes: [String] } | 201 CREATED ‚Äî retorna objeto Campanha salvo (id, timestamps, listas inicializadas). Valida√ß√µes: campos obrigat√≥rios; 400 se ausentes. |
| GET /campanha/buscaGeral | **Lista todas as campanhas** | nenhum | 200 OK ‚Äî array de Campanha |
| GET /campanha/buscaPorNome?nome={nome} | **Busca campanha por nome** (exato) | Query: nome (String, obrigat√≥rio) | 200 OK ‚Äî Campanha | 404 se n√£o encontrada; 400 se nome inv√°lido |
| GET /campanha/buscaPorSistema?sistema={sistema} | **Lista campanhas por sistema** | Query: sistema (String, obrigat√≥rio) | 200 OK ‚Äî lista de Campanha | 404 se nenhuma; 400 se par√¢metro inv√°lido |
| DELETE /campanha/deletar?id={id} | **Deleta campanha por id** | Query: id (Long, obrigat√≥rio) | 200 OK ‚Äî mensagem de sucesso | 400 se id nulo; 404 se n√£o existir |
| POST /campanha/atualizar | **Salva resumo/a√ß√£o da √∫ltima sess√£o** (adiciona ao contexto narrativo) | Body (JSON): ResumoDTO { nomeCampanha, resumoSessao } | 200 OK ‚Äî mensagem "Campanha atualizada com sucesso" | 400 se campos nulos; 404 se campanha n√£o encontrada |

| Request | Descri√ß√£o | Par√¢metros | Resultado |
|---|---:|---|---|
| POST /personagens/criar?campanhaId={campanhaId} | **Cria um personagem** (NPC ou jogador) e associa √† campanha | Query: campanhaId (Long, obrigat√≥rio) Body (JSON): PersonagemDTO (veja exemplos) | 201 CREATED ‚Äî objeto Personagem salvo; campanha atualizada com o personagem |
| GET /personagens/buscarTodos?campanhaId={id}&nomeCampanha={nome} | **Retorna todos os personagens de uma campanha** ‚Äî informe ao menos `campanhaId` ou `nomeCampanha` | Query: campanhaId (opcional), nomeCampanha (opcional) ‚Äî pelo menos um necess√°rio | 200 OK ‚Äî lista de Personagem | 400 se ambos ausentes |
| GET /personagens/busca?nomeCampanha={nomeCampanha}&nomePersonagem={nomePersonagem} | **Busca personagem espec√≠fico** pelo nome dentro de uma campanha | Query: nomeCampanha (String), nomePersonagem (String) | 200 OK ‚Äî Personagem | 404 se n√£o encontrado |
| PUT /personagens/atualizar?nomeCampanha={nomeCampanha} | **Atualiza um personagem** ‚Äî envie o objeto Personagem completo no body | Query: nomeCampanha (String, obrigat√≥rio) Body: Personagem (JSON) | 200 OK ‚Äî objeto Personagem salvo/atualizado |

---

## ‚úèÔ∏è Exemplos R√°pidos

Exemplo CampanhaDTO (body para POST /campanha/criar):
```json
{
  "nome": "A Jornada de X",
  "sistema": "Dungeons & Dragons 5e",
  "descricaoHistoria": "Uma hist√≥ria sobre drag√µes e um artefato perdido...",
  "restricoes": ["sem pvp", "sem magia divina elevada"]
}
```

cURL criar campanha:
```bash
curl -X POST "http://localhost:8080/campanha/criar" \
  -H "Content-Type: application/json" \
  -d '{ "nome":"A Jornada de X", "sistema":"Dungeons & Dragons 5e", "descricaoHistoria":"Uma hist√≥ria sobre drag√µes...", "restricoes":["sem pvp"] }'
```

Exemplo m√≠nimo PersonagemDTO (body para POST /personagens/criar?campanhaId=1):
```json
{
  "nome":"Gorim",
  "idade":40,
  "sexo":"MASCULINO",
  "nivel":5,
  "classe":"Guerreiro",
  "forca":16,
  "destreza":12,
  "constituicao":14,
  "npc":false
}
```

cURL criar personagem:
```bash
curl -X POST "http://localhost:8080/personagens/criar?campanhaId=1" \
  -H "Content-Type: application/json" \
  -d '{ "nome":"Gorim", "idade":40, "nivel":5, "classe":"Guerreiro", "forca":16, "destreza":12, "constituicao":14, "npc":false }'
```

---

## üßæ Documenta√ß√£o (Swagger / OpenAPI)
A aplica√ß√£o exp√µe OpenAPI via springdoc. Ap√≥s iniciar a aplica√ß√£o acesse:
- **Swagger UI:** http://localhost:8080/swagger-ui.html  
  ou http://localhost:8080/swagger-ui/index.html
- **JSON OpenAPI:** http://localhost:8080/v3/api-docs

---

## üóÑÔ∏è Banco de Dados

H2 (desenvolvimento ‚Äî in-memory, j√° incluido):
Exemplo application.properties (H2):
```
spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=
spring.jpa.hibernate.ddl-auto=update
spring.h2.console.enabled=true
spring.h2.console.path=/h2-console
```

PostgreSQL (produ√ß√£o ‚Äî configurar credenciais):
```
spring.datasource.url=jdbc:postgresql://host:5432/seu_banco
spring.datasource.username=usuario
spring.datasource.password=senha
spring.jpa.hibernate.ddl-auto=update
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
```

---

## üß™ Testes
Rodar su√≠te de testes:
```bash
./mvnw test
```

---

## üß© Estrutura do Projeto (resumo)
- com.API.Controle.Rpg.api
    - ApiApplication.java ‚Äî ponto de entrada Spring Boot
    - config/SwaggerConfiguration.java ‚Äî OpenAPI info
    - resource/ ‚Äî controllers REST (CampanhaController, PersonagemController)
    - services/ ‚Äî l√≥gica de neg√≥cio (CampanhaService, PersonagemService)
    - repositories/ ‚Äî Spring Data JPA repositories
    - domain/model/ ‚Äî entidades JPA (Campanha, Personagem)
    - domain/dtos/ ‚Äî DTOs (CampanhaDTO, PersonagemDTO, ResumoDTO)
    - exceptions/ ‚Äî exce√ß√µes customizadas e handler
    - mappers/ ‚Äî (MapStruct mapper placeholder)

---

## ‚ö†Ô∏è Tratamento de Erros
- **400 Bad Request:** par√¢metros ausentes ou inv√°lidos (ex.: cria√ß√£o sem campos obrigat√≥rios; listar personagens sem par√¢metros).
- **404 Not Found:** campanha ou personagem n√£o encontrados.
- Exce√ß√µes customizadas definidas no c√≥digo: `BadRequestException`, `NotFoundException`. Existe um handler central que normaliza respostas de erro (ErrorResponseDTO).

---

## ü§ù Contribui√ß√£o
- Abra uma issue descrevendo a proposta ou problema.
- Fa√ßa fork do reposit√≥rio, crie uma branch `feature/*` ou `bugfix/*` e envie um PR.
- Mantenha compatibilidade com Java 17 e siga o estilo do projeto.
- Para mudan√ßas p√∫blicas, adicione uma licen√ßa adequada (veja abaixo).

---

## ‚úâÔ∏è Contato
- Autor: **KaikeTinoco** (reposit√≥rio original)
- Para d√∫vidas ou sugest√µes: abra uma issue no reposit√≥rio.

---

Obrigado por usar/avaliar o projeto! Se desejar, posso **gerar payloads mais completos**, criar uma **Postman collection** com as rotas, ou adicionar **exemplos de resposta** para cada endpoint. üôå